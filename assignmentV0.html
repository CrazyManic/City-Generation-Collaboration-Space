<html>
<head>
    <title>Simple Geometry Test</title>
</head>
<style>

    body {
        margin: 0;
    }

    canvas {
        width: 100%;
        height: 100%;
    }
</style>
<body>
    <!--include the three.js library-->
    <script src="js/three.js"></script>
    <script src="js/Block.js"></script>
    <style>

        body {
            font-family: Monospace;
            background-color: #000;
            color: #fff;
            margin: 0px;
            overflow: hidden;
        }

        #info {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
        }
    </style>
    <div id="info">
        <p>This is a threeJS Test<br>
    </div>
    <script>

        //create the scene
        var scene = new THREE.Scene();

        //create the webgl renderer
        var renderer = new THREE.WebGLRenderer();

        renderer.setSize(window.innerWidth, window.innerHeight);

        //add the renderer to the current document
        document.body.appendChild(renderer.domElement);

        var ratio = window.innerWidth / window.innerHeight;

        //create the perspective camera
        //for parameters see https://threejs.org/docs/#api/cameras/PerspectiveCamera
        var camera = new THREE.PerspectiveCamera(45, ratio, 0.00001, 1000);
        var Pos = new THREE.Vector3(0, 0, 0);
        camera.position.set(Pos.x, Pos.y, Pos.z);
        var Dir = new THREE.Vector3(0, 0, 1);
        camera.lookAt(Dir.x, Dir.y, Dir.z);

        // Set game constants
        var loadRadius = 80; //arbitrary and untested
        console.log('Blocks grid size: ' + Block.gridSize); // I do not know how to access this from another file!

        // Set game variables
        var playerPos = new THREE.Vector3(0, 0, 0);
        var playerLook = new THREE.Vector3(0, 0, -1);
        var velo = new THREE.Vector3(0,0,0); //velocity
        var accel = new THREE.Vector3(0,0,0);//acceleration

        // Initialise blocks
        var blocks = [];

        const clock = new THREE.Clock();
        //var delta = clock.getDelta(); // use this as necessary, just not in this indentation block.

        // Gameplay functions
        function UpdatePlayerPosition() {
            var delta = clock.getDelta();
            // Make sure acceleration is up to date. 
            // Apply friction, i.e acc += velo * -0.05
            //velo.add(accel.multiplyScalar(delta); // should be correct
            //playerPos.add(velo.multiplyScalar(delta));

            for (i = 0; i < blocks.length; i++) {
                if (blocks[i].position.distanceTo(playerPos) > loadRadius) { // Destroy this block

                }
            }
        }

        var MyUpdateLoop = function () {
            // code
            requestAnimationFrame(MyUpdateLoop);
        }
        requestAnimationFrame(MyUpdateLoop);

        //this function is called when the window is resized
        var MyResize = function () {
            //get the new sizes
            var width = window.innerWidth;
            var height = window.innerHeight;
            //then update the renderer
            renderer.setSize(width, height);
            //and update the aspect ratio of the camera
            camera.aspect = width / height;

            //update the projection matrix given the new values
            camera.updateProjectionMatrix();

            //and finally render the scene again
            renderer.render(scene, camera);
        };

        // Input
        var onKeyDown = function (event) {

            switch (event.keyCode) {
                case 38: // up
                case 87: // w
                    playerPos.z += 10; // just to test movement. 
                    break;

                case 37: // left
                case 65: // a
                    
                    break;

                case 40: // down
                case 83: // s
                    
                    break;

                case 39: // right
                case 68: // d
                    
                    break;
            }

        };

        var onKeyUp = function (event) {

            switch (event.keyCode) {
                case 38: // up
                case 87: // w
                    
                    break;

                case 37: // left
                case 65: // a
                    
                    break;

                case 40: // down
                case 83: // s
                    
                    break;

                case 39: // right
                case 68: // d
                    
                    break;
            }
        };

        //link the resize of the window to the update of the camera
        window.addEventListener('resize', MyResize);
        document.addEventListener('keydown', onKeyDown, false);
        document.addEventListener('keyup', onKeyUp, false);


    </script>
</body>
</html>
